 {% extends "layout.njk"  %}


{% block head %}
    <link rel="stylesheet" href="/bookmarks/create.css">
    <title>FavLinks</title>
    
{% endblock %}
 
 {% block content %}

    <header>
        <div class="createBookmark-header">
              <h1> ⭐ {{user.name}}! save your <span>FavLinks !</span> </h1>
        </div>
    </header>


    <form  method="POST" action="/bookmarks/create"  enctype="multipart/form-data">

        <div class="fieldsCreateBookmark"  >
            <h2>Here you can save your favorites tech-blogs</p>
            <p>title : <input placeholder="eg: Name/Label Blog" type="text" name="label"></p>
            <p>link : <input placeholder="eg:http://example.com.br" type="text" name="link"></p>
            <input  id="tokenSession" name="token" type="hidden" value="{{token}}">
            <input  id="idSession" name="id" type="hidden" value="{{user.id}}">
             
        </div>

        <button class="create-button-form"  type="submit">Save ⭐</button>
    </form>

    <h1>My FavLinks</h1>

    <div class="bookmarks">
         {% for bookmark in bookmarks %}
            <div  class="bookmark-card">

            <div class="header-card">
                <h2>{{bookmark.label}}</h2>
                <p>{{bookmark.link}}</p>
            </div>    
            

            <div class="forms">
                <form method="GET" action="edit/" enctype="multipart/form-data">
                    <button type="submit">editar</button>
                </form>

                <form  method="POST" action="/bookmarks/delete" enctype="multipart/form-data">
                    <input value="{{bookmark.id}}" name="id_bookmark" type="hidden">
                    <input id="tokenUser" name="token" type="hidden" value="{{token}}">
                    <input id="idUser" name="id" type="hidden" value="{{user.id}}">
                    <button type="submit">deletar</button>
                </form>
        </div>
            
        </div>
        {% endfor %}
    </div>

    <script>

            let firstUserTokenSession = window.document.querySelector("#tokenSession")
            let firstUserIdSession = window.document.querySelector("#idSession")


            let bookmarksUserToken = window.document.querySelectorAll("#tokenUser");
            let bookmarksUserId = window.document.querySelectorAll("#idUser");

            let tokenSessionStorage = sessionStorage.getItem("token");
            let idSessionStorage = sessionStorage.getItem("id");

            function saveDataSessionStorage(){
                sessionStorage.setItem("token", `${firstUserTokenSession.value}`);
                sessionStorage.setItem("id", `${firstUserIdSession.value}`)
            }

            if(firstUserTokenSession.value || firstUserIdSession.value ){
                saveDataSessionStorage()
            }
            if(!firstUserIdSession.value || !firstUserTokenSession.value){
                firstUserTokenSession.setAttribute("value", `${tokenSessionStorage}`)
                firstUserIdSession.setAttribute("value", `${idSessionStorage}`)
                 
            }
            if(!bookmarksUserId[0].value || !bookmarksUserToken[0].value){
                
                   for(i = 0 ; i < bookmarksUserId.length ; i++ ){

                        bookmarksUserToken[i].setAttribute("value", `${tokenSessionStorage}`)
                        bookmarksUserId[i].setAttribute("value", `${idSessionStorage}`)

                   }        
                
            }

    </script>


     {% endblock %}